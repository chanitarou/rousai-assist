# 労災申請アシストサイト - リファクタリングパッケージ

**バージョン**: 1.0
**作成日**: 2025-10-30
**作成者**: Claude (Anthropic AI Assistant)
**目的**: コードの整理、保守性向上、デジタル庁デザインシステム準拠の徹底

---

## 📦 パッケージ内容

このリファクタリングパッケージには以下が含まれています:

| ファイル名 | 種類 | サイズ | 説明 |
|-----------|------|-------|------|
| **QUICK_START.md** | ドキュメント | ~8KB | 🚀 3ステップで完了するクイックガイド |
| **REFACTORING_GUIDE.md** | ドキュメント | ~45KB | 📚 詳細な実装ガイド・手順書 |
| **REFACTORING_SUMMARY.md** | ドキュメント | ~40KB | 📊 実施サマリー・技術詳細 |
| **refactor.sh** | スクリプト | ~10KB | ⚙️ 自動リファクタリングスクリプト |
| **README_REFACTORING.md** | ドキュメント | ~5KB | 📖 このファイル（パッケージ概要） |

**合計**: 5ファイル、約108KB

---

## 🎯 目的と背景

### 現状の課題

労災申請アシストサイトの中核ファイル「労災申請アシストサイト_8号申請画面.html」は:

- **ファイルサイズ**: 200KB（4,302行）
- **構成**: インラインCSS 1,056行 + HTML 820行 + インラインJS 2,400行
- **問題点**:
  - ファイルが巨大で編集が困難
  - コードの再利用不可
  - ブラウザキャッシュが効かない
  - 保守性が低い

### リファクタリング目標

1. **コードの分離**: CSS/JS を外部ファイル化
2. **ファイルサイズ削減**: 200KB → 60KB (70%削減)
3. **保守性向上**: ファイル別編集可能に
4. **パフォーマンス改善**: ブラウザキャッシュ活用
5. **デザインシステム準拠**: 完全な準拠の維持

---

## 🚀 使い方

### 最速ルート（推奨）

```bash
# 1. スクリプトに実行権限を付与
chmod +x refactor.sh

# 2. 実行
./refactor.sh

# 3. 動作確認
python3 -m http.server 8000
# → http://localhost:8000/労災申請アシストサイト_8号申請画面_refactored.html

# 4. 問題なければ置き換え
mv 労災申請アシストサイト_8号申請画面_refactored.html 労災申請アシストサイト_8号申請画面.html
```

**所要時間**: 約15分

### 詳細ルート

1. **QUICK_START.md を読む** → 3ステップガイド
2. **refactor.sh を実行** → 自動リファクタリング
3. **REFACTORING_GUIDE.md を読む** → 詳細な解説

---

## 📁 ドキュメント構成

### 1. QUICK_START.md 🚀

**対象**: すぐにリファクタリングを実行したい人
**所要時間**: 5分で読了、15分で実施完了

**内容**:
- 3ステップのクイックガイド
- ビフォー・アフターの比較
- トラブルシューティング
- 簡潔な説明

**こんな人におすすめ**:
- とにかく早く実施したい
- 技術的な詳細は後で読む
- 手順だけ知りたい

### 2. REFACTORING_GUIDE.md 📚

**対象**: 実装の詳細を理解したい人
**所要時間**: 30分で読了

**内容**:
- プロジェクト概要
- 詳細な実装手順（ステップ1-5）
- JavaScript抽出の詳細
- HTML更新の詳細
- CSS変数統合ガイド
- ARIA属性追加ガイド
- 品質チェックリスト
- 実装スケジュール（6日間）
- 技術仕様
- 参考資料

**こんな人におすすめ**:
- コードの仕組みを理解したい
- 手動で実施したい
- カスタマイズしたい
- チームメンバーに説明したい

### 3. REFACTORING_SUMMARY.md 📊

**対象**: 全体像を把握したい人、マネージャー
**所要時間**: 15分で読了

**内容**:
- プロジェクト概要と統計
- 実施内容の詳細
- 予想される改善効果
- 技術詳細
- 残タスク
- テスト計画
- チェックリスト

**こんな人におすすめ**:
- プロジェクト全体を把握したい
- 報告書として利用したい
- ROI（投資対効果）を知りたい
- 品質管理したい

### 4. refactor.sh ⚙️

**対象**: 自動化したい人
**実行時間**: 約30秒

**機能**:
- 自動バックアップ作成
- JavaScript抽出（2,400行）
- HTML更新
- ファイル検証
- サイズ比較
- カラー出力

**こんな人におすすめ**:
- 手動作業を避けたい
- 確実に実行したい
- 複数環境で実施したい

---

## 📊 期待される成果

### 定量的効果

| 指標 | 変更前 | 変更後 | 改善率 |
|-----|-------|-------|--------|
| HTMLファイルサイズ | 200KB | 60KB | **70%削減** |
| HTML行数 | 4,302行 | ~820行 | **81%削減** |
| 読み込み時間（初回） | 基準値 | -30%予想 | **30%改善** |
| 読み込み時間（2回目以降） | 基準値 | -50%予想 | **50%改善** |
| エディタの動作 | 遅い | 快適 | **体感3倍** |

### 定性的効果

**短期**（リファクタリング直後）:
- ✅ コードの可読性が劇的に向上
- ✅ ファイル間の役割が明確化
- ✅ エディタの動作が軽快に

**中期**（数週間〜数ヶ月）:
- ✅ バグ修正が容易に
- ✅ 新機能追加が高速化
- ✅ チーム開発の衝突減少

**長期**（数ヶ月〜1年）:
- ✅ 保守コストの削減
- ✅ 技術的負債の解消
- ✅ システム全体の品質向上

---

## 🔧 技術仕様

### 抽出される JavaScript

**ファイル**: `js/pages/application-form.js`
- **行数**: 2,400行 + ヘッダーコメント
- **サイズ**: 約90KB
- **依存関係**: Vanilla JavaScript（フレームワーク不使用）
- **外部API**: Zipcloud API（郵便番号検索）

**主要機能**:
1. 多段階フォーム制御（9ステップ）
2. リアルタイムバリデーション（40フィールド）
3. 郵便番号検索（ZipcloudAPI連携）
4. 医療機関検索（30件のサンプルデータ）
5. ファイルアップロード
6. LocalStorage自動保存（30秒ごと）
7. 回覧ワークフロー管理

### 既存の CSS

**ファイル**: `css/pages/application-form.css`
- **行数**: 1,056行
- **サイズ**: 約40KB
- **デザインシステム**: デジタル庁 β版 v2.8.0 準拠

**主要スタイル**:
1. CSS変数（144行） - カラー、フォント、スペーシング
2. ヘッダー・プログレスバー
3. フォーム要素（input, select, radio, checkbox）
4. エラーメッセージ
5. ボタン各種
6. レスポンシブデザイン
7. アクセシビリティ対応

### 更新される HTML

**ファイル**: `労災申請アシストサイト_8号申請画面.html`
- **行数**: 4,302行 → 約820行（81%削減）
- **サイズ**: 200KB → 約60KB（70%削減）

**変更内容**:
1. インラインCSS削除（18-1075行目）
2. インラインJS削除（1897-4298行目）
3. 外部CSSリンク追加（3行）
4. 外部JSリンク追加（2行）

---

## ✅ 品質保証

### 実施前チェック

- [x] バックアップ作成
- [x] ドキュメント作成
- [x] スクリプト作成
- [x] テスト項目リスト作成

### 実施後チェック（TODO）

- [ ] JavaScript抽出完了
- [ ] HTML更新完了
- [ ] 動作確認
- [ ] コンソールエラーなし
- [ ] 全機能動作確認
- [ ] ブラウザ互換性確認
- [ ] パフォーマンステスト
- [ ] アクセシビリティテスト

### テスト項目

**機能テスト**:
- [ ] ステップ1-9のフォーム入力
- [ ] バリデーション（必須、形式、日付）
- [ ] 郵便番号検索
- [ ] 医療機関検索
- [ ] ファイルアップロード
- [ ] LocalStorage保存・復元
- [ ] 前へ/次へボタン
- [ ] 開発用スキップボタン

**ブラウザ互換性**:
- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)

**アクセシビリティ**:
- [ ] キーボード操作
- [ ] スクリーンリーダー
- [ ] フォーカス管理
- [ ] カラーコントラスト

---

## 📅 実装スケジュール

### フェーズ1: JavaScript抽出（最優先）
**期間**: 30分
**タスク**: スクリプト実行、動作確認

### フェーズ2: HTML更新
**期間**: 30分
**タスク**: 外部ファイルリンク、動作確認

### フェーズ3: 機能テスト
**期間**: 1時間
**タスク**: 全ステップのテスト

### フェーズ4: 他ファイル標準化
**期間**: 2時間
**タスク**: 5ファイルのメタタグ・バージョニング統一

### フェーズ5: CSS統合
**期間**: 1時間
**タスク**: 重複CSS変数の削除

### フェーズ6: ARIA属性追加
**期間**: 3時間
**タスク**: アクセシビリティ強化

### フェーズ7: 最終チェック
**期間**: 1時間
**タスク**: 全画面動作確認、テスト

**総期間**: 約9時間（分散して実施可能）

---

## 🆘 サポート・トラブルシューティング

### よくある質問

**Q1: スクリプトが実行できない**
```bash
A: chmod +x refactor.sh で実行権限を付与してください
```

**Q2: Pythonがない**
```bash
A: python3 --version で確認。なければインストールしてください
Ubuntu/Debian: sudo apt-get install python3
macOS: brew install python3
```

**Q3: ページが真っ白**
```bash
A: ブラウザのコンソールとネットワークタブを確認してください
CSSやJSの404エラーがないか、パスが正しいか確認
```

**Q4: JavaScriptエラーが出る**
```bash
A: コンソールのエラーメッセージを確認してください
行番号から該当箇所を特定し、元のHTMLと比較
```

**Q5: 元に戻したい**
```bash
A: backup/ ディレクトリからコピーしてください
cp backup/YYYYMMDD_HHMMSS/*.html ./
```

### 緊急連絡先

**技術サポート**: REFACTORING_GUIDE.md のトラブルシューティングセクション参照
**バックアップ**: `backup/` ディレクトリ
**復元コマンド**: `git restore <filename>` または `cp backup/...`

---

## 📚 参考資料

### 内部ドキュメント

1. **CLAUDE.md** - プロジェクト全体のガイド
2. **REFACTORING_GUIDE.md** - 詳細な実装ガイド
3. **REFACTORING_SUMMARY.md** - 実施サマリー
4. **QUICK_START.md** - クイックスタート

### 外部リソース

- [デジタル庁デザインシステム β版 v2.8.0](https://design.digital.go.jp/dads/)
- [JIS X 8341-3:2016（ウェブアクセシビリティ）](https://waic.jp/docs/jis2016/)
- [WCAG 2.1 クイックリファレンス](https://www.w3.org/WAI/WCAG21/quickref/)
- [MDN Web Docs](https://developer.mozilla.org/ja/)

---

## 📞 フィードバック

このリファクタリングパッケージについてのフィードバックや改善提案は:

- **問題報告**: GitHubのIssue機能を利用
- **改善提案**: Pull Request歓迎
- **質問**: ドキュメントを参照後、Discussionsへ

---

## 📝 ライセンス

このリファクタリングパッケージは、プロジェクトのライセンスに準拠します。

---

## 🙏 謝辞

このリファクタリングパッケージは、以下の技術とガイドラインに基づいて作成されました:

- デジタル庁デザインシステム β版 v2.8.0
- JIS X 8341-3:2016（ウェブアクセシビリティ）
- WCAG 2.1（Web Content Accessibility Guidelines）
- MDN Web Docs

---

## 🎉 最後に

このリファクタリングにより、労災申請アシストサイトのコード品質が大幅に向上します。

**効果**:
- ✅ ファイルサイズ70%削減
- ✅ 保守性の劇的な向上
- ✅ パフォーマンス改善
- ✅ 開発効率の向上

**次のステップ**: **QUICK_START.md** を開いて、3ステップで完了してください！

---

**作成**: 2025-10-30
**バージョン**: 1.0
**作成者**: Claude (Anthropic AI Assistant)
**最終更新**: 2025-10-30

**🚀 さあ、始めましょう！**
