- name: Generate Gemini response
  id: gemini
  run: |
    COMMENT="@gpt-ryoichi-bot $COMMENT_TEXT"

    RAW=$(curl -s -X POST \
      -H "Content-Type: application/json" \
      -H "x-goog-api-key: ${{ secrets.GEMINI_API_KEY }}" \
      -d "{
        \"model\": \"gemini-1.5-flash\",
        \"contents\": [{
          \"parts\": [{\"text\": \"$COMMENT\"}]
        }]
      }" \
      https://generativelanguage.googleapis.com/v1beta/models/generateContent)

    echo "RAW RESPONSE:"
    echo "$RAW"

    # 正しいレスポンス形式を jq で抜き出し
    OUT=$(echo "$RAW" | jq -r '.candidates[0].content.parts[0].text // empty')

    echo "REPLY<<EOF" >> $GITHUB_OUTPUT
    echo "$OUT" >> $GITHUB_OUTPUT
    echo "EOF" >> $GITHUB_OUTPUT
